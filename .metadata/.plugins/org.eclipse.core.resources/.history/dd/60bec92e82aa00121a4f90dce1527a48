package com.example.servicetest;

import android.app.Service;
import android.content.Intent;
import android.os.IBinder;
import android.util.Log;

public class MyService extends Service {
	
	Jack message;
	BluetoothSerialService mmJTM;
	

	@Override
	public IBinder onBind(Intent arg0) {
		// TODO Auto-generated method stub
		return null;
	}
	
	@Override
	public void onCreate() {
		
		
		Log.d("service", "creato");
		
	}

	@Override
	public void onDestroy() {
		
		message.stop();
		
		Log.d("service", "distrutto");
		
	}
	
	
	@Override
	public void onStart(Intent intent, int startid) {
		
		mmJTM = new BluetoothSerialService();
		
		mmJTM.start();
		
		mmJTM.connect("00:06:66:48:54:E2");
		
		
		Jack message = new Jack(mmJTM) {

			@Override
			public void onReceive(JData message) {
				
				sendBroadcastIntent((String) message.get("key"));
				
			}
			
		};
		
		Log.d("service", "start");
	}
	
	public int onStartCommand(Intent intent, int flags, int startId) {
	
		
		//message.start();
		
		return Service.START_STICKY;
	}
	
	
	public void sendBroadcastIntent(String s) {
		
		Log.e("test", s);
		
		Intent intent = new Intent("testIntent");
    	intent.putExtra("testo", s);

    	sendBroadcast(intent);
		 
	}
	/*
	
	public class CThread extends Thread {
			
		BluetoothSerialService mBluetoothSerialService;
			
			public void run() {
				
				mBluetoothSerialService = new BluetoothSerialService();
				
				mBluetoothSerialService.start();
				
				mBluetoothSerialService.connect("00:06:66:48:54:E2");
				
				while (true) {
					if(mBluetoothSerialService.s.length() > 5) {
						send(mBluetoothSerialService.s);
						
						mBluetoothSerialService.s = "";
					}
					
				}
				
				
				
			}
			
			public void disconnect() {
				mBluetoothSerialService.stop();
			}
			
	}*/

}
